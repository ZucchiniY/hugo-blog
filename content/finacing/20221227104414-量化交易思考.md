---
title: "量化交易思考"
author: ["夏南瓜", "欧内斯特·陈", "陈凯"]
date: 2023-01-19T00:00:00+08:00
lastmod: 2023-02-09T14:55:46+08:00
series: ["笔记"]
tags: ["策略", "指标"]
categories: ["量化"]
draft: false
---

## 华尔街幽灵 {#华尔街幽灵}

-   如果不迅速的被证明正确，那就是错误

    如果建仓后趋势徘徊甚至往你建仓相反的方向移动，则迅速离场，主动止损，为了省一点手续费去死扛或者干等，那种付出几百倍的割肉亏损和时间精力情绪的煎熬不值得。

-   正确加码是获取更多利润的方法

    正确加码的前提是已经正确盈利了，而且需要更高的技术，在正确后的某一点出现规则时迅速扩张盈利时加码。

-   巨量即是套现良机

    正确盈利后，巨量可能是情绪量能，也可能是换手巨量，但都是减仓或者止盈的好机会。


## 实盘交易与回测有偏差 {#实盘交易与回测有偏差}

在实盘的时候，经常发现实盘操作会和回测交易有一定的偏差，这个偏差主要有下面几种可能：

-   确认订单与回测订单是否一致
-   交易成本计算是否正确
-   数据过拟合造成偏差
-   市场规律已经发生改变


## 止损与离场 {#止损与离场}

止损和离场策略最大的区别是止损是一种破位的决策，是防止损失过大；而离场是一种变化的决策，是期望获取更多的收益。


### 止损策略 {#止损策略}

-   与22天前比较，不能弱于22天前的涨势判断价格需要如何变化，才能像22天前的价格一样，（上涨多少或者下跌多少，如果未达到预期则清仓）
-   当天价格与买入日价格的收益＞当天22天前价格 &divide; 买入日与22天前 买入收益高于22天前买入的收益
-   下跌超过1倍atr 止损
-   下跌超过0.5倍atr止损
-   macd.diff连续下跌三天止损


### 离场策略 {#离场策略}

-   固定持仓周期
-   目标价格或者盈利目标
-   最新进场信号
-   止损价


## 凯利公式与最优资金 {#凯利公式与最优资金}

凯利公式和最优资金配置是一种理论上的投资方案，体现的是一种收资、投资比例。

但是这些都只是理论上的内容，在实际的投资过程中，收益、损失、无风险利率都是变化的，而这种变化会让凯利公式失去作用。


### 凯利公式 {#凯利公式}

凯利公式通过指出在一个期望收益为正的重复性赌局或者重复性投资中，每一期应该下注的最优比例。

-   f = \frac{b \times p - q}{b}
-   f 投资比例、b盈亏比、p胜率、q亏损概率（即q=1-p）

这个公式主要用来确定资金的比例，特别是指出 **当持仓亏损时，应该减仓** 而不是在亏损是加码。


### 最优资金配置 {#最优资金配置}

-   最大化长期财富，相当于最大化投资组合的长期复合投资回报率 g
-   r 无风险利率
-   S 夏普比率
-   g = r + S^2 /2


## 感知学习算法 {#感知学习算法}

-   感知学习是神经网络算法的一种
-   这个算法可以基于一个历史训练数据集的移动容器，在最大化容器整体收益的目标下，找到具有不同持仓周期的交易规则间的最优权重。
-   基于这些最优化的权重，感觉学习可以在每个周期结束的时候，触发买入和卖出决策。
-   可选策略：KMeans 或者 遗传算法


## 协整股票对 {#协整股票对}

-   通过构造一组股票组合，让组合在某种手段下，构造成一个不会向期初值偏离越来越远的组合，这组股票组合各自的时间序列的关系称为协整。
-   平衡时间序列是非常好的均值回归策略。

-   通过协整增强方法来检验协整率。
    -   通过 `statsmodels.tsa.stattools` 中的 `adfuller` 来判断是否为一阶单整
    -   通过 `statsmodels.tsa.stattools` 中的 `coint` 来判断是为协整关系

之后可以利用 ols() 线性回归查找对冲比例。


## Talib 指标 {#talib-指标}

COPP
: 估波指标，估算月度价格的变化速率的加权平均值来测量市场的动量。周期参数一般设置为 11、14，加权平均参数为 10

KST
: 完定指标，该指标参考长、中、短期的变动率指标（ROC），指标将数个周期的价格变动率函数做加权。


## 策略获利指标 {#策略获利指标}

-   每个月都盈利，需要年化夏普率大于 2
-   每天都赢利，需要年化夏普比率大于 3


## 策略指标构建 {#策略指标构建}


### MACD 顶底背离 {#macd-顶底背离}

-   价格新高，MACD 没新高，是顶背离
-   价格新低，MACD 无新低，是底背离
-   DIF = (EMA(CLOSE, SHORT)-EMA(CLOSE,LONG))/EMA(CLOSE,LONG)\*10000


### 阻力支撑强度（RSRS）指标构建 {#阻力支撑强度-rsrs-指标构建}

1.  获取前 N 日的股票最高价序列和最低价序列
2.  将两个序列构建线性回归方程，求得斜率 B
3.  获取前 M 日的斜率 B 的时间序列
4.  将获取的斜率 B 的时间序列进行标准化
5.  将标准化后的斜率 B 的值作为 RSRS 指标的值

RSRS 指标超过阈值时则看多，低于阈值则看空。

阈值：斜率 B 的均值加减一个标准差作为阈值。
